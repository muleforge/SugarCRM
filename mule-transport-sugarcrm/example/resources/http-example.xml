<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesource.org/schema/mule/core/2.2"
	xmlns:http="http://www.mulesource.org/schema/mule/http/2.2"
	xmlns:https="http://www.mulesource.org/schema/mule/https/2.2" xmlns:vm="http://www.mulesource.org/schema/mule/vm/2.2"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:sugarcrm="http://www.mulesource.org/schema/mule/sugarcrm/2.2"
	xsi:schemaLocation="
       http://www.mulesource.org/schema/mule/core/2.2 http://www.mulesource.org/schema/mule/core/2.2/mule.xsd
       http://www.mulesource.org/schema/mule/vm/2.2 http://www.mulesource.org/schema/mule/vm/2.2/mule-vm.xsd
       http://www.mulesource.org/schema/mule/sugarcrm/2.2 http://www.mulesource.org/schema/mule/sugarcrm/2.2/mule-sugarcrm.xsd">

<custom-transformer name="SingleQueryTransformer"
		class="org.mule.transport.sugarcrm.transformers.SingleQueryTransformer" />

	<custom-transformer name="StreamToUserInput"
		class="org.mule.transport.sugarcrm.example.transformers.StreamToUserInput" />
	<custom-transformer name="EntryResponseToHtml"
		class="org.mule.transport.sugarcrm.example.transformers.EntryResponseToHtml" />

	<message-properties-transformer name="addContentType">
		<add-message-property key="Content-Type" value="text/html" />
	</message-properties-transformer>

        <context:property-placeholder location="sugarcrm.properties"/>

	<model name="sugarcrmHttpExample">
	
	<service name="test">
		<inbound>
			<inbound-endpoint address="http://localhost:8090/test"/>
		</inbound>
		<log-component/>
	</service>
		<service name="RouteInput">
			<inbound>
				<inbound-endpoint address="http://localhost:8081/getcontacts"
					transformer-refs="StreamToUserInput" responseTransformer-refs="EntryResponseToHtml addContentType"
					synchronous="true" />
			</inbound>
			<component
				class="org.mule.transport.sugarcrm.example.HttpExampleInvoker">
				<binding interface="org.mule.transport.sugarcrm.example.IHttpExample"
					method="login">
					<vm:outbound-endpoint address="vm://test.login"
						synchronous="true" />
				</binding>
				<binding interface="org.mule.transport.sugarcrm.example.IHttpExample"
					method="query">
					<vm:outbound-endpoint address="vm://test.singleQuery"
						synchronous="true" />
				</binding>
			</component>

		</service>

		<service name="sugarcrmServiceLogin">
			<inbound>
				<vm:inbound-endpoint address="vm://test.login"
					synchronous="true" />
			</inbound>
			<outbound>
				<pass-through-router>
					<outbound-endpoint
						address="sugarcrm://${sugarcrmUrl}?operation=login"
						synchronous="true" />
				</pass-through-router>
			</outbound>
		</service>

		<service name="sugarcrmServiceSingleQuery">
			<inbound>
				<inbound-endpoint address="vm://test.singleQuery"
					synchronous="true" />
			</inbound>
			<outbound>
				<pass-through-router>
					<outbound-endpoint
						address="sugarcrm://${sugarcrmUrl}?operation=query"
						transformer-refs="SingleQueryTransformer" synchronous="true" />
				</pass-through-router>
			</outbound>
		</service>

	</model>
</mule>
